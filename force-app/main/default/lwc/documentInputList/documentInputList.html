<template>
        <div class="slds-form slds-form_horizontal slds-p-horizontal_small slds-p-vertical_small">
            
            <h3 class="slds-text-heading_small slds-p-vertical_x-small slds-border_bottom slds-m-bottom_small slds-text-title_bold">
                Required Documentation
            </h3>

            <template if:true={isLoading}>
                <div class="slds-is-relative slds-m-vertical_large" style="min-height: 50px;">
                    <lightning-spinner alternative-text="Loading" size="small"></lightning-spinner>
                </div>
            </template>

            <template if:true={documents}>
                <template for:each={documents} for:item="doc">
                    <div key={doc.key} class="slds-form-element slds-border_bottom_reset slds-p-vertical_x-small">

                        <label class="slds-form-element__label slds-col slds-size_1-of-3" for={doc.value}>
                            {doc.label}
                        </label>

                        <div class="slds-form-element__control slds-col slds-size_2-of-3">
                            
                            <template if:true={doc.isUploaded}>
                                <div class="slds-grid slds-grid_align-spread slds-grid_vertical-align-center">
                                    <!-- File Name Display (No Link) -->
                                    <div class="slds-truncate slds-has-flexi-truncate">
                                        <lightning-icon icon-name="utility:check" size="x-small" variant="success" class="slds-p-right_small"></lightning-icon>
                                        <span class="slds-text-body_regular slds-text-color_success" title={doc.name}>{doc.name}</span>
                                    </div>

                                    <!-- Actions Menu: Preview & Delete -->
                                    <div class="slds-shrink-none slds-m-left_small">
                                        <!-- In the Actions Menu part of your HTML -->
                                        <lightning-button-menu alternative-text="Actions" variant="border-filled" icon-size="x-small" menu-alignment="right">
                                            <!-- Preview Option -->
                                            <!-- IMPORTANT: data-fileid must bind to doc.contentDocumentId -->
                                            <lightning-menu-item 
                                                label="Preview File" 
                                                icon-name="utility:preview" 
                                                data-fileid={doc.contentDocumentId} 
                                                onclick={handlePreview}>
                                            </lightning-menu-item>
                                            
                                            <!-- Delete Option -->
                                            <lightning-menu-item 
                                                label="Delete" 
                                                icon-name="utility:delete" 
                                                class="slds-text-color_error"
                                                data-docid={doc.id} 
                                                onclick={handleDelete}>
                                            </lightning-menu-item>
                                        </lightning-button-menu>
                                    </div>
                                </div>
                            </template>

                            <template if:true={doc.isMissing}>
                                <lightning-file-upload
                                    label="" 
                                    name="fileUploader"
                                    record-id={recordId}
                                    onuploadfinished={handleUploadFinished}
                                    accepted-formats=".pdf, .png, .jpg"
                                    data-doctype={doc.value}
                                    class="compact-upload"
                                >
                                </lightning-file-upload>
                            </template>

                        </div>
                    </div>
                </template>
            </template>
        </div>
    </template>