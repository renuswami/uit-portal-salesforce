<template>
    <lightning-card title="Employee Time Logs" icon-name="custom:custom25">
        <div class="slds-p-around_medium">
            <!-- Filter Section -->
            <div class="slds-grid slds-wrap slds-gutters slds-grid_vertical-align-end slds-m-bottom_medium filter-section">
                <!-- 1. Month Filter -->
                <div class="slds-col slds-size_1-of-1 slds-medium-size_4-of-12 filter-item slds-m-bottom_small">
                    <lightning-combobox
                        name="month"
                        label="Month"
                        value={selectedMonth}
                        options={monthOptions}
                        onchange={handleMonthChange}
                        placeholder="Select Month"
                        class="filter-dropdown">
                    </lightning-combobox>
                </div>

                <!-- 2. Start Date -->
                <div class="slds-col slds-size_1-of-1 slds-medium-size_4-of-12 filter-item slds-m-bottom_small">
                    <lightning-input
                        type="date"
                        name="startDate"
                        label="Start Date"
                        value={startDate}
                        onchange={handleStartDateChange}
                        class="date-input">
                    </lightning-input>
                </div>

                <!-- 3. End Date -->
                <div class="slds-col slds-size_1-of-1 slds-medium-size_4-of-12 filter-item slds-m-bottom_small">
                    <lightning-input
                        type="date"
                        name="endDate"
                        label="End Date"
                        value={endDate}
                        onchange={handleEndDateChange}
                        class="date-input">
                    </lightning-input>
                </div>

                <!-- 4. Week Filter -->
                <div class="slds-col slds-size_1-of-1 slds-medium-size_4-of-12 filter-item slds-m-bottom_small">
                    <lightning-combobox
                        name="week"
                        label="Week"
                        value={selectedWeek}
                        options={weekOptions}
                        onchange={handleWeekChange}
                        placeholder="Select Week"
                        class="filter-dropdown">
                    </lightning-combobox>
                </div>
                
                <!-- 5. Log Type Filter -->
                <div class="slds-col slds-size_1-of-1 slds-medium-size_4-of-12 filter-item slds-m-bottom_small">
                    <lightning-combobox
                        name="logFilter"
                        label="Log Type"
                        value={logFilter}
                        options={filterOptions}
                        onchange={handleFilterChange}
                        class="filter-dropdown">
                    </lightning-combobox>
                </div>
            </div>

            <!-- Loading Spinner -->
            <template if:true={isLoading}>
                <div class="slds-is-relative slds-p-around_large">
                    <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
                </div>
            </template>

            <!-- Data Grid -->
            <template if:false={isLoading}>
                <div class="slds-grid slds-wrap slds-gutters">
                    <template for:each={summaries} for:item="summary">
                        <div key={summary.employeeName} class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3 slds-m-bottom_medium">
                            <div class="slds-box slds-box_small card-container custom-card">
                                <!-- Row 1: Billable Breakdown (Visible for All or Logged Hours) -->
                                <template if:true={showBillableBreakdown}>
                                    <div class="slds-grid slds-gutters slds-text-align_center slds-border_bottom slds-p-bottom_x-small">
                                        <div class="slds-col slds-size_1-of-2 slds-border_right">
                                            <div class="slds-text-heading_small slds-text-color_success">{summary.totalBillable}</div>
                                            <div class="slds-text-body_small">Billable</div>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2">
                                            <div class="slds-text-heading_small slds-text-color_error">{summary.totalNonBillable}</div>
                                            <div class="slds-text-body_small">Non-Billable</div>
                                        </div>
                                    </div>
                                </template>

                                <!-- Row 2: Side-by-Side View for "All" Filter -->
                                <template if:true={isAllFilter}>
                                    <div class="slds-grid slds-gutters slds-text-align_center slds-p-vertical_x-small slds-border_bottom">
                                        <div class="slds-col slds-size_1-of-2 slds-border_right">
                                            <div class="slds-text-heading_medium slds-text-title_bold">{summary.totalHours}</div>
                                            <div class="slds-text-body_small">Total Hours</div>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2">
                                            <div class="slds-text-heading_medium slds-text-color_success slds-text-title_bold">{summary.totalApprovedHours}</div>
                                            <div class="slds-text-body_small">Approved Logged Hours</div>
                                        </div>
                                    </div>
                                </template>

                                <!-- Row 2 (Others): Single Column Total Hours -->
                                <template if:true={showTotalHours}>
                                    <div class="slds-text-align_center slds-p-vertical_x-small slds-border_bottom">
                                        <!-- For Approved Filter, show totalApprovedHours. For others (Logged Hours), show totalHours -->
                                        <template if:true={isApprovedFilter}>
                                            <div class="slds-text-heading_medium slds-text-color_success slds-text-title_bold">{summary.totalApprovedHours}</div>
                                            <div class="slds-text-body_small">Approved Logged Hours</div>
                                        </template>
                                        <template if:false={isApprovedFilter}>
                                            <div class="slds-text-heading_medium slds-text-title_bold">{summary.totalHours}</div>
                                            <div class="slds-text-body_small">Total Hours</div>
                                        </template>
                                    </div>
                                </template>
                                
                                <!-- Row 3: Approved Logged Hours (Visible Only for All Filter) -->
                                <template if:true={showApprovedRow}>
                                    <div class="slds-text-align_center slds-p-vertical_x-small slds-border_bottom">
                                        <div class="slds-text-heading_small">{summary.totalApprovedHours}</div>
                                        <div class="slds-text-body_small">Approved Logged Hours</div>
                                    </div>
                                </template>

                                <!-- Last Row: Employee Name and Report View Action -->
                                <div class="slds-text-align_center slds-p-top_x-small">
                                    <div class="slds-text-heading_small">
                                        {summary.employeeName}
                                        <a href="#" class="slds-m-left_small action-link" data-name={summary.employeeName} onclick={handleReportView}>Report View</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
                
                <template if:false={summaries.length}>
                    <div class="slds-text-align_center slds-m-top_medium">
                        No time logs found for the selected period.
                    </div>
                </template>
            </template>
        </div>
    </lightning-card>
</template>
